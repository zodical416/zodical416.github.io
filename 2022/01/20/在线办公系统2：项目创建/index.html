<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zodical416.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="覆水不能收、摔杯不减愁的梅子酒">
<meta property="og:type" content="article">
<meta property="og:title" content="办公系统 2. 项目创建及基础配置（一）">
<meta property="og:url" content="https://zodical416.github.io/2022/01/20/%E5%9C%A8%E7%BA%BF%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F2%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/index.html">
<meta property="og:site_name" content="Zodiacal">
<meta property="og:description" content="覆水不能收、摔杯不减愁的梅子酒">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119102137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119102327.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119110505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119110922.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119112414.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119123904.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119123935.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119124036.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119124755.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119124839.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120160932.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120161042.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120161123.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120161234.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120165149.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120165210.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120165409.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120180916.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220120181602.png">
<meta property="article:published_time" content="2022-01-20T10:29:59.138Z">
<meta property="article:modified_time" content="2022-01-29T14:23:53.156Z">
<meta property="article:author" content="Zodiacal">
<meta property="article:tag" content="项目实战">
<meta property="article:tag" content="小程序">
<meta property="article:tag" content="Spring Boot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zodical416/picto/master/20220119102137.png">

<link rel="canonical" href="https://zodical416.github.io/2022/01/20/%E5%9C%A8%E7%BA%BF%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F2%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>办公系统 2. 项目创建及基础配置（一） | Zodiacal</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Zodiacal</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zodical416.github.io/2022/01/20/%E5%9C%A8%E7%BA%BF%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F2%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zodiacal">
      <meta itemprop="description" content="引出魔鬼的一种试炼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zodiacal">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          办公系统 2. 项目创建及基础配置（一）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-20 18:29:59" itemprop="dateCreated datePublished" datetime="2022-01-20T18:29:59+08:00">2022-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-29 22:23:53" itemprop="dateModified" datetime="2022-01-29T22:23:53+08:00">2022-01-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">办公系统</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>
            <div class="post-description">覆水不能收、摔杯不减愁的梅子酒</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="从零开始构建项目"><a href="#从零开始构建项目" class="headerlink" title="从零开始构建项目"></a>从零开始构建项目</h1><h2 id="创建-SpringBoot-项目"><a href="#创建-SpringBoot-项目" class="headerlink" title="创建 SpringBoot 项目"></a>创建 SpringBoot 项目</h2><p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119102137.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119102327.png"></p>
<p>依赖库界面，勾选如下内容：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>库名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>SpringBoot DevTools</td>
<td>热部署插件</td>
</tr>
<tr>
<td>2</td>
<td>Lombok</td>
<td>生成SET/GET方法</td>
</tr>
<tr>
<td>3</td>
<td>Spring Web</td>
<td>SpringMVC框架</td>
</tr>
<tr>
<td>4</td>
<td>MySQL Driver</td>
<td>MySQL数据库驱动</td>
</tr>
<tr>
<td>5</td>
<td>MyBatis Framework</td>
<td>MyBatis持久层框架</td>
</tr>
<tr>
<td>6</td>
<td>Spring Data Redis</td>
<td>操作Redis技术</td>
</tr>
<tr>
<td>7</td>
<td>Spring Data MongoDB</td>
<td>操作MongoDB技术</td>
</tr>
<tr>
<td>8</td>
<td>Spring For RabbitMQ</td>
<td>RabbitMQ驱动</td>
</tr>
<tr>
<td>9</td>
<td>Java Mail Sender</td>
<td>邮件发送技术</td>
</tr>
<tr>
<td>10</td>
<td>QuartZ Scheduler</td>
<td>定时器技术</td>
</tr>
</tbody></table>
<p>将 application.properties 修改为 application.yml （shift + F6）</p>
<h2 id="配置-Tomcat"><a href="#配置-Tomcat" class="headerlink" title="配置 Tomcat"></a>配置 Tomcat</h2><p>直接将配置信息粘贴至 yml 文件：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">uri-encoding:</span> <span class="string">UTF-8</span> <span class="comment"># 字符集</span></span><br><span class="line">    <span class="attr">threads:</span> <span class="comment"># 线程数，最大200，最小30</span></span><br><span class="line">      <span class="attr">max:</span> <span class="number">200</span></span><br><span class="line">      <span class="attr">min-spare:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="string">5000ms</span> <span class="comment"># 超时时间5s</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> </span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/emos-wx-api</span> <span class="comment"># 部署路径</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-MySQL-数据源"><a href="#配置-MySQL-数据源" class="headerlink" title="配置 MySQL 数据源"></a>配置 MySQL 数据源</h2><p>采用阿里巴巴的 druid 数据库连接池</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment"># 数据源类型</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span> <span class="comment"># jdbc 驱动类</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/emos?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span> <span class="comment"># 连接信息</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">547815635Aa</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">8</span> <span class="comment"># 数据库连接池的连接数量，一般为CPU内核的一到两倍</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">16</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span> <span class="comment"># 最大等待时间ms</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span> <span class="comment"># 检测连接是否有效</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>由于没有导入依赖库，需要在 pom 文件中添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-Redis-数据源"><a href="#配置-Redis-数据源" class="headerlink" title="配置 Redis 数据源"></a>配置 Redis 数据源</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#这里省略MySQL配置信息</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span> <span class="comment"># 使用0号逻辑库</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">547815635Aa</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span> <span class="comment"># 数据源连接池</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">1000</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">16</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-MongoDB-数据源"><a href="#配置-MongoDB-数据源" class="headerlink" title="配置 MongoDB 数据源"></a>配置 MongoDB 数据源</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#这里省略MySQL配置信息</span></span><br><span class="line">  <span class="comment">#这里省略Redis配置信息</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">emos</span></span><br><span class="line">      <span class="attr">authentication-database:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">abc123456</span></span><br></pre></td></tr></table></figure>

<h1 id="配置-MyBatis"><a href="#配置-MyBatis" class="headerlink" title="配置 MyBatis"></a>配置 MyBatis</h1><h2 id="创建-IDEA-数据库连接"><a href="#创建-IDEA-数据库连接" class="headerlink" title="创建 IDEA 数据库连接"></a>创建 IDEA 数据库连接</h2><p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119110505.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119110922.png"></p>
<h2 id="生成-MyBatis-各种文件"><a href="#生成-MyBatis-各种文件" class="headerlink" title="生成 MyBatis 各种文件"></a>生成 MyBatis 各种文件</h2><ol>
<li><p>创建<code>com.example.emos.wx.db.pojo</code>和<code>com.example.emos.wx.db.dao</code>包 </p>
<p>普通 Java Bean 和 数据库访问对象</p>
</li>
<li><p>选中业务表，生成对应文件</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119112414.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119123904.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119123935.png"></p>
<p>最终生成的文件：</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119124036.png"></p>
</li>
<li><p>在每个 Dao 接口(Mapper 文件夹内)上添加注解</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119124755.png"></p>
<p>清空 xml 文件中 Mapper 标签内的内容</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220119124839.png"></p>
</li>
<li><p>配置 MyBatis</p>
<p>在 yml 文件中加入配置信息</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">mapper-locations:</span> <span class="string">classpath*:mapper/*.xml</span> <span class="comment"># xml 文件路径</span></span><br><span class="line"><span class="attr">type-aliases-package:</span> <span class="string">com.example.emos.wx.db.pojo</span> <span class="comment"># pojo 映射类路径</span></span><br><span class="line"><span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># 日志输出的实现方案</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># 支持驼峰命名法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置日志输出</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span> <span class="comment"># 输出级别</span></span><br><span class="line">    <span class="attr">com.example.emos.wx.db.mapper :</span> <span class="string">warn</span> <span class="comment"># mapper中的接口调高为警告级别</span></span><br><span class="line"><span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d&#123;HH:mm:ss&#125;  %-5level  %msg%n&quot;</span> <span class="comment"># 日志格式</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="创建自定义异常类"><a href="#创建自定义异常类" class="headerlink" title="创建自定义异常类"></a>创建自定义异常类</h1><p>因为后台Java项目是Web工程，所以有异常消息，我们要在原有异常消息的基础之上，封装状态码，所以需要我们自己创建一个异常类。</p>
<p>自定义异常类继承的父类，我没有选择Exception。因为Exception类型的异常，我们必须要手动显式处理，要么上抛，要么捕获。我希望我定义的异常采用既可以采用显式处理，也可以隐式处理，所以我选择继承RuntimeException这个父类。RuntimeException类型的异常可以被虚拟机隐式处理，这样就省去了我们很多手动处理异常的麻烦。</p>
<p>异常所包含的属性包括异常消息与状态码</p>
<ol>
<li><p>创建<code>com.example.emos.wx.exception</code>包</p>
</li>
<li><p>创建 EmosException 类</p>
<p> 定义了四个构造器：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmosException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmosException</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmosException</span><span class="params">(String msg, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg, e);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmosException</span><span class="params">(String msg, <span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmosException</span><span class="params">(String msg, <span class="keyword">int</span> code, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg, e);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="封装-Web-返回对象"><a href="#封装-Web-返回对象" class="headerlink" title="封装 Web 返回对象"></a>封装 Web 返回对象</h1><p>Java Web项目需要统一数据返回格式：业务状态码、业务消息、业务数据，因此需要将后端返回给客户端的数据封装起来，防止混乱。</p>
<p>虽然SpringMVC的Controller可以自动把对象转换成JSON返回给客户端，但是我们需要制定一个统一的标准，保证所有Controller返回的数据格式一致。最简便的办法就是定义封装类，来统一封装返回给客户端的数据。</p>
<p>修改<code>pom.xml</code>文件，添加依赖库。<code>Apache</code>的<code>httpcomponents</code>库里面的<code>HttpStatus</code>类封装了很多状态码，所以当我们在Web返回对象中封装状态码时，可以用到这些状态码。</p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>先创建<code>com.example.emos.wx.common.util</code>包，再创建 R 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.common.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">R</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        put(<span class="string">&quot;code&quot;</span>, HttpStatus.SC_OK);</span><br><span class="line">        put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 声名 put 方法，实现链式调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 声明静态工厂方法，若请求成功，则可以直接调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义重载方法，可自己指定业务消息，状态码默认为200</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.put(<span class="string">&quot;msg&quot;</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重载方法:数据先存入 map，再交给重载方法，ok方法可将数据封装到R对象中返回</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.putAll(map);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 若请求失败，出现异常</span></span><br><span class="line">    <span class="comment">// 声明静态工厂方法 error,封装异常的状态码与业务消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">(<span class="keyword">int</span> code, String msg)</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        r.put(<span class="string">&quot;msg&quot;</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重载方法,固定状态码为500</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> error(HttpStatus.SC_INTERNAL_SERVER_ERROR, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重载无参方法,默认状态码为500,异常消息内容可选</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> error(HttpStatus.SC_INTERNAL_SERVER_ERROR, <span class="string">&quot;未知异常，请联系管理员&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="利用-Swagger-搭建-REST-API"><a href="#利用-Swagger-搭建-REST-API" class="headerlink" title="利用 Swagger 搭建 REST API"></a>利用 Swagger 搭建 REST API</h1><p>开发前后端分离架构的项目，往往调试后端Web接口需要用到POSTMAN工具。虽然POSTMAN工具的功能非常强大，但是请求参数很多的情况下，我们手写这些参数和数据还是非常麻烦的。因此我们需要一个调试后端Web接口更加简便的方法。恰好Swagger提供了REST API调用方式，我们不需要借助任何工具的情况下，访问Swagger页面，就可以对Web接口进行调用和调试，这种调试方式的效率要远超POSTMAN软件。</p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>Swagger 版本：Swagger2，添加依赖库：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建-Swagger-配置类"><a href="#创建-Swagger-配置类" class="headerlink" title="创建 Swagger 配置类"></a>创建 Swagger 配置类</h2><p>在<code>com.example.emos.wx.config</code>包中创建<code>SwaggerConfig</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.RequestHandler;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiKey;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.AuthorizationScope;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.SecurityReference;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.ApiSelectorBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 加Configuration注解，否则所有配置信息都无效</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Swagger 所有的配置信息都将封装在 Docket 对象中，因此返回 Docket 对象，且该对象返回给 SpringBoot 项目，因此加 Bean 注解</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">creatRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Docket docket = <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2);</span><br><span class="line">        <span class="comment">// 往 docket 中添加配置信息，如在 Swagger 页面中设置标题文字、项目的描述信息</span></span><br><span class="line">        ApiInfoBuilder builder = <span class="keyword">new</span> ApiInfoBuilder();</span><br><span class="line">        builder.title(<span class="string">&quot;BNI EMOS 在线办公系统&quot;</span>);</span><br><span class="line">        <span class="comment">// 不能直接把 builder 交给 docket 对象，还需要封装成 ApiInfo 对象</span></span><br><span class="line">        ApiInfo info = builder.build();</span><br><span class="line">        <span class="comment">// 将 info 传入 docket 对象</span></span><br><span class="line">        docket.apiInfo(info);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 需要将 Controller 中的所有 Web 方法添加到 Swagger 页面，从而进行执行测试，需要设置哪些类的哪些方法需要添加至 Swagger 界面</span></span><br><span class="line">        ApiSelectorBuilder selectorBuilder = docket.select();</span><br><span class="line">        <span class="comment">// 默认将所有包下的所有类添加到 Swagger 中，而后续限定所有类中所有使用特定注解的方法才会出现在 Swagger 页面</span></span><br><span class="line">        selectorBuilder.paths(PathSelectors.any());</span><br><span class="line">        selectorBuilder.apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class)); <span class="comment">// 规定使用注解的方法才会出现在 Swagger 页面，注解使用 @ApiOperation</span></span><br><span class="line">        docket = selectorBuilder.build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使 Swagger 支持 JWT，这种单点登录的技术，每次发起请求都需上传令牌字符串，因此必须告知 Swagger 客户端提交的令牌是放在请求头还是请求体、参数名是什么</span></span><br><span class="line">        ApiKey apiKey = <span class="keyword">new</span> ApiKey(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;token&quot;</span>, <span class="string">&quot;header&quot;</span>); <span class="comment">// 客户端发起 JWT 请求时需要上传令牌，传入的三个参数规定了在请求头接受客户端上传的令牌，从请求头中的 token 提取令牌字符串，keyname 为描述性信息</span></span><br><span class="line">        <span class="comment">// 将对象放在 List 中</span></span><br><span class="line">        List&lt;ApiKey&gt; apiKeyList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        apiKeyList.add(apiKey);</span><br><span class="line">        docket.securitySchemes(apiKeyList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设定令牌作用域：全局</span></span><br><span class="line">        AuthorizationScope scope = <span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;accessEverything&quot;</span>);</span><br><span class="line">        <span class="comment">// 将对象放在数组中</span></span><br><span class="line">        AuthorizationScope[] scopes = &#123;scope&#125;;</span><br><span class="line">        <span class="comment">// 封装数组</span></span><br><span class="line">        SecurityReference reference = <span class="keyword">new</span> SecurityReference(<span class="string">&quot;token&quot;</span>, scopes);</span><br><span class="line">        <span class="comment">// 封装 Reference 到 List</span></span><br><span class="line">        List refList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        refList.add(reference);</span><br><span class="line">        <span class="comment">// 封装 List</span></span><br><span class="line">        SecurityContext context = SecurityContext.builder().securityReferences(refList).build();</span><br><span class="line">        <span class="comment">// 封装 context</span></span><br><span class="line">        List cxtList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        cxtList.add(context);</span><br><span class="line">        docket.securityContexts(cxtList);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建-Web-方法测试-Swagger"><a href="#创建-Web-方法测试-Swagger" class="headerlink" title="创建 Web 方法测试 Swagger"></a>创建 Web 方法测试 Swagger</h2><p>在<code>com.example.emos.wx.controller</code>包中创建<code>TestController</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.emos.wx.common.util.R;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">// 类中所有的 Web 方法接收和返回的数据都是 JSON 格式的</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span> <span class="comment">// 为 controller 类分配相对路径</span></span><br><span class="line"><span class="meta">@Api(&quot;测试Web接口&quot;)</span> <span class="comment">// 加上该注解后 Swagger 才会扫描该 Java 类里面的 Web 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sayHello&quot;)</span> <span class="comment">// 分配相对路径</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试方法&quot;)</span> <span class="comment">// 使用该注解的方法才会出现在 Swagger 页面</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;HelloWorld&quot;</span>); <span class="comment">// 工厂方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试-Web-接口"><a href="#测试-Web-接口" class="headerlink" title="测试 Web 接口"></a>测试 Web 接口</h2><p>打开浏览器，访问<code>http://127.0.0.1:8080/emos-wx-api/swagger-ui.html</code></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120160932.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120161042.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120161123.png"></p>
<p>点击右上角认证按钮，可在弹出对话框中填写令牌字符串，将来调用任何需要认证的方法时，Swagger 会自动在请求头添加该字符串</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120161234.png"></p>
<h1 id="配置后端验证功能"><a href="#配置后端验证功能" class="headerlink" title="配置后端验证功能"></a>配置后端验证功能</h1><p>若要接收客户端提交的数据，需要在 SpringBoot 上做后端验证</p>
<h2 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>对于客户端提交表单或者Ajax中的数据，后端的Controller必须先要做验证，然后才能使用这些数据。既然要验证数据，那么可以使用一下Validation库。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建-form-类"><a href="#创建-form-类" class="headerlink" title="创建 form 类"></a>创建 form 类</h2><p><code>validation</code>库在做后端验证的时候，要求必须用封装类（Form类）来保存客户端提交的数据，然后在封装类中，我们可以定义验证的规则，<code>validation</code>会执行这些规则，帮我们验证客户端提交的数据。</p>
<p>我们为之前的<code>TestController</code>里面的<code>sayHello()</code>方法设置一个Form类，接受客户端提交的<code>name</code>数据。我们在<code>com.example.emos.wx.controller.form</code>包里面创建<code>TestSayHelloForm</code>类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.controller.form;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel</span> <span class="comment">// 封装类需要出现在 Swagger 界面上</span></span><br><span class="line"><span class="meta">@Data</span> <span class="comment">// 姓名数据，需要 Set Get 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSayHelloForm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank</span> <span class="comment">// 变量即不能为空也不能为空字符串</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[\\u4e00-\\u9fa5]&#123;2,15&#125;$&quot;)</span> <span class="comment">// 正则表达式规定字符串的形势：\u4e00-\u9fa5表示必须为简中汉字，个数为2个到15个</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;姓名&quot;)</span> <span class="comment">// 对 name 变量的描述</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改-sayHello-方法"><a href="#修改-sayHello-方法" class="headerlink" title="修改 sayHello() 方法"></a>修改 sayHello() 方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.emos.wx.common.util.R;</span><br><span class="line"><span class="keyword">import</span> com.example.emos.wx.controller.form.TestSayHelloForm;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">// 类中所有的 Web 方法接收和返回的数据都是 JSON 格式的</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span> <span class="comment">// 为 controller 类分配相对路径</span></span><br><span class="line"><span class="meta">@Api(&quot;测试Web接口&quot;)</span> <span class="comment">// 加上该注解后 Swagger 才会扫描该 Java 类里面的 Web 方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sayHello&quot;)</span> <span class="comment">// Web 方法可以接收客户端提交的数据，需将Get改为Post</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试方法&quot;)</span> <span class="comment">// 使用该注解的方法才会出现在 Swagger 页面</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sayHello</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> TestSayHelloForm form)</span> </span>&#123; <span class="comment">// 为 sayHello 方法添加参数，即封装类，由于客户端提交的数据都保存到封装类中，封装成对象，因此加 @RequestBody，对提交的数据进行后端的验证，加@Valid，验证通过则执行方法内容</span></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Hello,&quot;</span> + form.getName()); <span class="comment">// 工厂方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h2><p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120165149.png"></p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120165210.png"></p>
<p>显示成功，正常返回响应：</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120165409.png"></p>
<h1 id="抵御跨站脚本-XSS-攻击"><a href="#抵御跨站脚本-XSS-攻击" class="headerlink" title="抵御跨站脚本(XSS)攻击"></a>抵御跨站脚本(XSS)攻击</h1><h2 id="XSS-攻击及危害"><a href="#XSS-攻击及危害" class="headerlink" title="XSS 攻击及危害"></a>XSS 攻击及危害</h2><p>XSS攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但实际上也可以包括Java、 VBScript、ActiveX、 Flash 或者甚至是普通的HTML。攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和cookie等各种内容。</p>
<p>例如用户在发帖或者注册的时候，在文本框中输入<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，这段代码如果不经过转义处理，而直接保存到数据库。将来视图层渲染HTML的时候，把这段代码输出到页面上，那么<code>&lt;script&gt;</code>标签的内容就会被执行。</p>
<p>通常情况下，我们登陆到某个网站。如果网站使用<code>HttpSession</code>保存登陆凭证，那么<code>SessionId</code>会以<code>Cookie</code>的形式保存在浏览器上。如果黑客在这个网页发帖的时候，填写的<code>JavaScript</code>代码是用来获取<code>Cookie</code>内容的，并且把<code>Cookie</code>内容通过Ajax发送给黑客自己的电脑。于是只要有人在这个网站上浏览黑客发的帖子，那么视图层渲染HTML页面，就会执行注入的XSS脚本，于是你的<code>Cookie</code>信息就泄露了。黑客在自己的电脑上构建出<code>Cookie</code>，就可以冒充已经登陆的用户。</p>
<p>即便很多网站使用了JWT，登陆凭证（Token令牌）是存储在浏览器上面的。所以用XSS脚本可以轻松的从Storage中提取出<code>Token</code>，黑客依然可以轻松的冒充已经登陆的用户。</p>
<p>所以避免XSS攻击最有效的办法就是对用户输入的数据进行转义，然后存储到数据库里面。等到视图层渲染HTML页面的时候。转义后的文字是不会被当做JavaScript执行的，这就可以抵御XSS攻击。</p>
<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h2><p>因为Hutool工具包带有XSS转义的工具类，所以我们要导入Hutool，然后利用Servlet规范提供的请求包装类，定义数据转义功能。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="定义请求包装类"><a href="#定义请求包装类" class="headerlink" title="定义请求包装类"></a>定义请求包装类</h2><p>我们平时写Web项目遇到的HttpServletRequest，它其实是个接口。如果我们想要重新定义请求类，扩展这个接口是最不应该的。因为HttpServletRequest接口中抽象方法太多了，我们逐一实现起来太耗费时间。所以我们应该挑选一个简单一点的自定义请求类的方式。那就是继承HttpServletRequestWrapper父类。</p>
<p>JavaEE只是一个标准，具体的实现由各家应用服务器厂商来完成。比如说Tomcat在实现Servlet规范的时候，就自定义了HttpServletRequest接口的实现类。同时JavaEE规范还定义了HttpServletRequestWrapper，这个类是请求类的包装类，用上了装饰器模式。不得不说这里用到的设计模式真的非常棒，无论各家应用服务器厂商怎么去实现HttpServletRequest接口，用户想要自定义请求，只需要继承HttpServletRequestWrapper，对应覆盖某个方法即可，然后把请求传入请求包装类，装饰器模式就会替代请求对象中对应的某个方法。用户的代码和服务器厂商的代码完全解耦，我们不用关心HttpServletRequest接口是怎么实现的，借助于包装类我们可以随意修改请求中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.config.xss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HtmlUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ReadListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssHttpServletRequestWrapper</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 声名构造器，不定义则无法接收传入的请求对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XssHttpServletRequestWrapper</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 getParameter 方法，使其经过转义</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        String value =  <span class="keyword">super</span>.getParameter(name); <span class="comment">// 保存父类接收到的变量</span></span><br><span class="line">        <span class="comment">// 判断数据是否有效，不能为空也不能为空值</span></span><br><span class="line">        <span class="keyword">if</span> (!StrUtil.hasEmpty(value)) &#123;</span><br><span class="line">            value = HtmlUtil.filter(value); <span class="comment">// 若不为空，则进行转义</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 getParameterValues 方法，使其经过转义</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">        String[] values = <span class="keyword">super</span>.getParameterValues(name);</span><br><span class="line">        <span class="comment">// 判断数组是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (values != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 若不为空，逐个对数组中元素进行转义</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; values.length;i++) &#123;</span><br><span class="line">                String value = values[i];</span><br><span class="line">                <span class="keyword">if</span> (!StrUtil.hasEmpty(value)) &#123;</span><br><span class="line">                    value = HtmlUtil.filter(value); <span class="comment">// 若不为空，则进行转义</span></span><br><span class="line">                &#125;</span><br><span class="line">                values[i] = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 getParameterMap 方法，使其经过转义</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String[]&gt; getParameterMap() &#123;</span><br><span class="line">        Map&lt;String, String[]&gt; parameters = <span class="keyword">super</span>.getParameterMap();</span><br><span class="line">        <span class="comment">// 定义一个新 map 存储转义后的数据，选择 LinkedHashMap 作为实现类，因为其能够保持一个插入的顺序</span></span><br><span class="line">        Map&lt;String, String[]&gt; map = <span class="keyword">new</span> LinkedHashMap();</span><br><span class="line">        <span class="keyword">if</span> (parameters!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String key:parameters.keySet()) &#123;</span><br><span class="line">                String[] values = parameters.get(key);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; values.length;i++) &#123;</span><br><span class="line">                    String value = values[i];</span><br><span class="line">                    <span class="keyword">if</span> (!StrUtil.hasEmpty(value)) &#123;</span><br><span class="line">                        value = HtmlUtil.filter(value); <span class="comment">// 若不为空，则进行转义</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    values[i] = value;</span><br><span class="line">                &#125;</span><br><span class="line">                map.put(key, values); <span class="comment">// 将处理后的数组放入新 map</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 getHeader 方法，使请求头中的数据经过转义</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHeader</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        String value = <span class="keyword">super</span>.getHeader(name);</span><br><span class="line">        <span class="keyword">if</span> (!StrUtil.hasEmpty(value)) &#123;</span><br><span class="line">            value = HtmlUtil.filter(value); <span class="comment">// 若不为空，则进行转义</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 getInputStream 方法，使请求头中的数据经过转义。</span></span><br><span class="line">    <span class="comment">// 该方法最重要，因为 SpringMVC 框架就是通过该方法从请求中提取客户端提交的数据，并将这些数据封装到 form 对象中</span></span><br><span class="line">    <span class="comment">// 方法返回值为 IO 流</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletInputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream in = <span class="keyword">super</span>.getInputStream();</span><br><span class="line">        InputStreamReader reader = <span class="keyword">new</span> InputStreamReader(in, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)); <span class="comment">// 从 IO 流中读对象，规定字符集</span></span><br><span class="line">        BufferedReader buffer = <span class="keyword">new</span> BufferedReader(reader); <span class="comment">// 为了读取数据的高效性，还应配置一个缓冲流</span></span><br><span class="line">        StringBuffer body = <span class="keyword">new</span> StringBuffer(); <span class="comment">// 保存从缓冲流中读取的数据</span></span><br><span class="line">        String line = buffer.readLine(); <span class="comment">// 读取缓冲流中的一行数据</span></span><br><span class="line">        <span class="keyword">while</span>(line != <span class="keyword">null</span>) &#123;</span><br><span class="line">            body.append(line);</span><br><span class="line">            line = buffer.readLine(); <span class="comment">// 读取下一行数据</span></span><br><span class="line">        &#125;</span><br><span class="line">        buffer.close();</span><br><span class="line">        reader.close();</span><br><span class="line">        in.close();</span><br><span class="line">        <span class="comment">// 数据类型转换：客户端数据为 JSON 格式，读取出的字符串内容也为 JSON 格式，Java 不支持原生 JSON 格式，因此需将 JSON 字符串转换为 map 对象</span></span><br><span class="line">        Map&lt;String, Object&gt; map = JSONUtil.parseObj(body.toString());</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap(map.size());</span><br><span class="line">        <span class="keyword">for</span> (String key:map.keySet()) &#123;</span><br><span class="line">            Object val = map.get(key);</span><br><span class="line">            <span class="comment">// 判断 val 是否为字符串格式的数据</span></span><br><span class="line">            <span class="keyword">if</span> (val <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                <span class="comment">// 转为字符串，判断是否为空</span></span><br><span class="line">                <span class="keyword">if</span> (!StrUtil.hasEmpty(val.toString())) &#123;</span><br><span class="line">                    result.put(key, HtmlUtil.filter(val.toString()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 若不为字符串，直接放入即可</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                result.put(key, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 先将 result 转为 JSON 格式的字符串，再创建 IO 流从中读数据</span></span><br><span class="line">        String json = JSONUtil.toJsonStr(result);</span><br><span class="line">        ByteArrayInputStream bain = <span class="keyword">new</span> ByteArrayInputStream(json.getBytes()); <span class="comment">// IO 流数据类型与要求返回的不同</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServletInputStream() &#123; <span class="comment">// 采用匿名内部类的方式进行实现，覆盖其中的 read 方法即可</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReady</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadListener</span><span class="params">(ReadListener readListener)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> bain.read();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建过滤器，把所有请求对象传入包装类"><a href="#创建过滤器，把所有请求对象传入包装类" class="headerlink" title="创建过滤器，把所有请求对象传入包装类"></a>创建过滤器，把所有请求对象传入包装类</h2><p>创建 filter 类，把拦截下来的请求封装成 Wrapper 对象，这样才能对请求中的数据做转义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.emos.wx.config.xss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span> <span class="comment">// 所拦截请求的路径：所有路径下的请求均拦截</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest; <span class="comment">// 转型，否则请求类型不对</span></span><br><span class="line">        XssHttpServletRequestWrapper wrapper = <span class="keyword">new</span> XssHttpServletRequestWrapper(request);</span><br><span class="line">        filterChain.doFilter(wrapper, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="给主类添加注解"><a href="#给主类添加注解" class="headerlink" title="给主类添加注解"></a>给主类添加注解</h2><p>给SpringBoot主类添加@ServletComponentScan注解，否则 filter 不会生效。</p>
<h2 id="测试拦截XSS脚本"><a href="#测试拦截XSS脚本" class="headerlink" title="测试拦截XSS脚本"></a>测试拦截XSS脚本</h2><ol>
<li><p>把<code>TestSayHelloForm</code>中的正则表达式验证给去掉，因为name字段只可以是中文，所以无法接收XSS脚本。</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120180916.png"></p>
</li>
<li><p>在Swagger中，执行<code>sayHello()</code>方法，向name属性传入<code>&lt;script&gt;alert(1234)&lt;/script&gt;</code>，然后观察返回的结果</p>
<p><img src="https://raw.githubusercontent.com/zodical416/picto/master/20220120181602.png"></p>
</li>
</ol>

      
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>


    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" rel="tag"># 项目实战</a>
              <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag"># 小程序</a>
              <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/18/%E5%9C%A8%E7%BA%BF%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F1%EF%BC%9A%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87/" rel="prev" title="办公系统 1. 工具准备">
      <i class="fa fa-chevron-left"></i> 办公系统 1. 工具准备
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/22/%E5%9C%A8%E7%BA%BF%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F3%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA2/" rel="next" title="办公系统 3. 项目创建及基础配置（二）">
      办公系统 3. 项目创建及基础配置（二） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.</span> <span class="nav-text">从零开始构建项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-SpringBoot-%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">创建 SpringBoot 项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Tomcat"><span class="nav-number">1.2.</span> <span class="nav-text">配置 Tomcat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-MySQL-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">1.3.</span> <span class="nav-text">配置 MySQL 数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Redis-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">1.4.</span> <span class="nav-text">配置 Redis 数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-MongoDB-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">1.5.</span> <span class="nav-text">配置 MongoDB 数据源</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-MyBatis"><span class="nav-number">2.</span> <span class="nav-text">配置 MyBatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-IDEA-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.</span> <span class="nav-text">创建 IDEA 数据库连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90-MyBatis-%E5%90%84%E7%A7%8D%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">生成 MyBatis 各种文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E7%B1%BB"><span class="nav-number">3.</span> <span class="nav-text">创建自定义异常类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%81%E8%A3%85-Web-%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.</span> <span class="nav-text">封装 Web 返回对象</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-Swagger-%E6%90%AD%E5%BB%BA-REST-API"><span class="nav-number">5.</span> <span class="nav-text">利用 Swagger 搭建 REST API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="nav-number">5.1.</span> <span class="nav-text">添加依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Swagger-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-number">5.2.</span> <span class="nav-text">创建 Swagger 配置类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Web-%E6%96%B9%E6%B3%95%E6%B5%8B%E8%AF%95-Swagger"><span class="nav-number">5.3.</span> <span class="nav-text">创建 Web 方法测试 Swagger</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-Web-%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.4.</span> <span class="nav-text">测试 Web 接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD"><span class="nav-number">6.</span> <span class="nav-text">配置后端验证功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96-1"><span class="nav-number">6.1.</span> <span class="nav-text">添加依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-form-%E7%B1%BB"><span class="nav-number">6.2.</span> <span class="nav-text">创建 form 类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-sayHello-%E6%96%B9%E6%B3%95"><span class="nav-number">6.3.</span> <span class="nav-text">修改 sayHello() 方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-number">6.4.</span> <span class="nav-text">执行测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%B5%E5%BE%A1%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC-XSS-%E6%94%BB%E5%87%BB"><span class="nav-number">7.</span> <span class="nav-text">抵御跨站脚本(XSS)攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#XSS-%E6%94%BB%E5%87%BB%E5%8F%8A%E5%8D%B1%E5%AE%B3"><span class="nav-number">7.1.</span> <span class="nav-text">XSS 攻击及危害</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">7.2.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%8C%85%E8%A3%85%E7%B1%BB"><span class="nav-number">7.3.</span> <span class="nav-text">定义请求包装类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E6%8A%8A%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%E4%BC%A0%E5%85%A5%E5%8C%85%E8%A3%85%E7%B1%BB"><span class="nav-number">7.4.</span> <span class="nav-text">创建过滤器，把所有请求对象传入包装类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E4%B8%BB%E7%B1%BB%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3"><span class="nav-number">7.5.</span> <span class="nav-text">给主类添加注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8B%A6%E6%88%AAXSS%E8%84%9A%E6%9C%AC"><span class="nav-number">7.6.</span> <span class="nav-text">测试拦截XSS脚本</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zodiacal</p>
  <div class="site-description" itemprop="description">引出魔鬼的一种试炼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zodiacal</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">484k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">7:20</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
